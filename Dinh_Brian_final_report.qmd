---
title: "Final Report on Brooklyn Housing Dataset (2003-2017)"
subtitle: |
  | Class: Data Science 1 with R (STAT 301-1)
author: "Brian Dinh"
date: today

format:
  html:
    toc: true
    embed-resources: true
    
execute:
  echo: true
  warning: false
number-sections: true
from: markdown+emoji 
---

::: {.callout-tip icon="false"}
## Github Repo Link

<https://github.com/stat301-1-2023-fall/final-project-1-BrianDinh26.git>
:::

```{r}
#| echo: false
#| label: import
#import dataset and libraries at top of document

#I do not want scientific notation for my graphs.
options(scipen = 999)

#libraries
library(tidyverse)
library(naniar)
library(janitor)
library(visdat)
library(ggthemes)

#import dataset
brooklyn_sales <- read_csv("data/brooklyn_sales_clean.csv")

#put these filterings in a SEPARATE CODE CHUNK LATER.
brooklyn_sales_res <- brooklyn_sales |> 
  filter(tax_class_at_sale == c("1", "2"))

brooklyn_sales_nonres <- brooklyn_sales |> 
  filter(tax_class_at_sale == c("3", "4"))

```

# Introduction {#sec-introduction}

For this report, I explored a dataset labelled "[Brooklyn Home Sales 2003 to 2017](https://www.kaggle.com/datasets/tianhwu/brooklynhomes2003to2017/data)," which describes information in regards to all buildings, residential and nonresidential, sold in the New York borough of Brooklyn. The data comes from the government of the state of New York, and links to the data can be found under References ([@sec-references]). Additionally, the cleaned dataset could not be uploaded to GitHub for the same reason, [so I have added a Google Drive link to it here](https://drive.google.com/drive/folders/1_OyRKj4xWoZ5CgJ5v0GhLubceh9yT5wW?usp=sharing).

For this exploratory data analysis, I was primarily motivated by my curiosity in what could be the main motivators for selling more buildings in the Brooklyn market, especially since buildings in this area tend to be more expensive than the rest of the United States due to its urbanity and access to New York City as a whole. Additionally, I wished to look at what factors could have affected housing price increases in the area. Last of all, I wanted to look at what areas in Brooklyn are the most desired based on the popularity in sales in this dataset and what neighborhoods have become less popular.

# Data Overview and Quality

For the original "Brooklyn Home Sales 2003 to 2017" dataset, there are 111 variables and 390,883 observations. There are 32 categorical variables, 71 numerical variables, 7 logical variables, and 1 date variable. 

There are missingness issues for many columns associated with geographic mapping information, borough data (e.g. what borough the building is in), and some building information (like total units, building stories, etc.). Due to this missingness, I will not be able to construct a geographic visualization of the data using a dashboard package like Shiny and may be limited in my analysis of nonresidential buildings, as thorough building information could affect nonresidential prices. I do not believe the missing borough data will affect my analysis because all of the buildings sold are located in Brooklyn.

The dataset is not in the GitHub for this final project as it is too large (207.6 MB) to commit to the GitHub, so please refer to the hyperlink above in Introduction ([@sec-introduction]) for access to the original dataset and the cleaned dataset.

The cleaned dataset has 390,833 observations and 81 columns. There are 19 categorical variables, 61 numeric variables, and 1 date variable.

# Explorations

## How many buildings are being sold in Brooklyn over time? How have these sales changed? Where are they being sold?

Before exploring this question, I wanted to check to see the different types of buildings being sold in Brooklyn, because my initial hypothesis assumes that the building type can greatly affect certain data about the building. The variable of `tax_class_at_sale` categorizes the type of building sold into 4 categories according to the state of New York:

* **(Class 1)**: Includes most residential property of up to three units (such as one-, two-, and three-family homes and small stores or offices with one or two attached apartments), vacant land that is zoned for residential use, and most condominiums that are not more than three stories.
* **(Class 2)**: Includes all other property that is primarily residential, such as cooperatives and condominiums.
* **(Class 3)**: Includes property with equipment owned by a gas, telephone or electric company.
* **(Class 4)**: Includes all other properties not included in class 1,2, and 3, such as offices, factories, warehouses, garage buildings, etc.

```{r}
#| echo: false
#| eval: true
#| label: fig-tax
#| fig-cap: "Distributions of Building Sold in Brooklyn by Tax Classes"
#| fig-subcap:
#|   - "Counts of Tax Classes of Buildings Sold in Brooklyn, 2003-2017"
#|   - "Distribution of Brooklyn Building Sale Prices by Tax Class and Time, 2003-2017"
#|   - "Distribution of Brooklyn Building Square Feet by Tax Class and Time, 2003-2017"
#| layout-ncol: 1

#figure 1a
brooklyn_sales |> 
  filter(is.na(tax_class_at_sale) == FALSE) |> 
  group_by(tax_class_at_sale) |> 
  mutate(tax_class_at_sale = as.factor(tax_class_at_sale),
         n = n()) |>
  ggplot(aes(y = fct_reorder(tax_class_at_sale, n), fill = tax_class_at_sale)) +
  theme_minimal() +
  geom_bar() +
  scale_x_continuous(label = scales::comma) +
  labs(
    y = "Tax Class\nAt Sale",
    x = "Count",
    caption = "Source: NYC Department of Finance"
  ) +
  theme(axis.title.y = element_text(angle = 0, vjust = 0.5),
        legend.position = "none")

#figure 1b
brooklyn_sales |> 
  mutate(tax_class_at_sale = as.factor(tax_class_at_sale)) |> 
  ggplot(aes(x = sale_date, y = sale_price, color = tax_class_at_sale)) +
  theme_minimal() +
  geom_line() +
  scale_y_continuous(labels = scales::dollar_format()) +
  labs(x = "Sale Date",
       y = "Sale Price",
       caption = "Source: NYC Department of Finance",
       color = "Tax Class\nat Sale") +
  theme(axis.title.y = element_text(angle = 0, vjust = 0.5))

#figure 1c
brooklyn_sales |> 
  mutate(tax_class_at_sale = as.factor(tax_class_at_sale)) |> 
  ggplot(aes(x = sale_date, y = land_sqft, color = tax_class_at_sale)) +
  theme_minimal() +
  geom_line() +
  scale_y_continuous(labels = scales::comma_format()) +
  labs(x = "Sale Date",
       y = "Square\nFt",
       caption = "Source: NYC Department of Finance",
       color = "Tax Class\nat Sale") +
  theme(axis.title.y = element_text(angle = 0, vjust = 0.5))
  
```

According to @fig-tax-1, it appears that the most actively sold buildings are primarily residential buildings in classes 1 and 2, with class 4 buildings coming third and class 3 buldings not being sold too often. Additionally, class 4 buildings appear to cause large skews in both price and square feet, as according to @fig-tax-2 and @fig-tax-3, the majority of larger and more expensive buildings were class 4.

Thus, I will separate my dataset into residential (class 1 and class 2) buildings and non-residential (class 3 and class 4) buildings, with the majority of my analysis focusing on the residential dataset.

```{r}
#| echo: false
#| label: tax-filter

brooklyn_sales_res <- brooklyn_sales |> 
  filter(tax_class_at_sale == c("1", "2"))

brooklyn_sales_nonres <- brooklyn_sales |> 
  filter(tax_class_at_sale == c("3", "4"))
```

After separating the dataset, I wanted to look at how the number of sales for buildings have changed year by year, as I want to see if there are any periods of downturns or relatively high counts of building sales.

```{r}
#| label: fig-year-count
#| echo: false
#| eval: true
#| fig-cap: Distribution of Brooklyn Building Sales by Year
#| fig-subcap:
#|   - "Number of Residential Building Sales in Brooklyn by Year"
#|   - "Number of Non-Residential Building Sales in Brooklyn by Year"
#| layout-ncol: 2

#figure 2a
brooklyn_sales_res |> 
  group_by(year_of_sale) |> 
  ggplot() +
  theme_minimal() +
  geom_bar(aes(y = year_of_sale), fill ="#d3e3e1", color = "black") +
  scale_y_reverse(breaks = c(2003, 2004, 2005, 2006,
                             2007, 2008, 2009, 2010,
                             2011, 2012, 2013, 2014,
                             2015, 2016, 2017)) +
  scale_x_continuous(labels = c("0", "5,000", "10,000", "15,000")) +
  labs(x = "Number of Sales",
       y = "Year of\nSale",
       caption = "Source: NYC Department of Finance") +
  theme(
    axis.title.y = element_text(angle = 0, 
                                vjust = 0.5,
                                margin = margin(t = 0, r = 10, b = 0, l = 0))
  )

#figure 2b
brooklyn_sales_nonres |> 
  group_by(year_of_sale) |> 
  ggplot() +
  theme_minimal() +
  geom_bar(aes(y = year_of_sale), fill ="#e9f2b8", color = "black") +
  scale_y_reverse(breaks = c(2003, 2004, 2005, 2006,
                             2007, 2008, 2009, 2010,
                             2011, 2012, 2013, 2014,
                             2015, 2016, 2017)) +
  labs(x = "Number of Sales",
       y = "Year of\nSale",
       caption = "Source: NYC Department of Finance") +
  theme(
    axis.title.y = element_text(angle = 0, 
                                vjust = 0.5,
                                margin = margin(t = 0, r = 10, b = 0, l = 0))
  )
```
In both @fig-year-count-1 and @fig-year-count-2, the distribution of sales in Brooklyn tended to be the highest from 2003 to 2006, while there was a significant dip in sales from 2007 to 2010, which was stronger for residential buildings than it was for non-residential buildings. From to 2011 to 2017, there appears to have been a recovery in building sales. These three time periods are interesting to look at in terms of determining if the three time periods had the same trends or not. For example, one immediate question I had was if the decrease in sales was due to an increase or decrease in price in the building market. To analyze this, I made the following line plots.

```{r}
#| label: fig-sale-line
#| echo: false
#| eval: true
#| fig-cap: Average Building Sale Prices by Year in Brooklyn
#| fig-subcap:
#|   - "Average Residential Building Sale Price by Year, Brooklyn"
#|   - "Average Non-Residential Building Sale Price by Year, Brooklyn"
#| layout-ncol: 1


# GRAPH OF AVG SALE PRICE OVER TIME FOR RESIDENTIAL ONLY
brooklyn_sales_res |> 
  group_by(year_of_sale) |> 
  mutate(yearly_avg_price = mean(sale_price)) |> 
  ggplot(aes(x = year_of_sale, y = yearly_avg_price)) +
  theme_minimal() + 
  geom_line(color ="#d3e3e1", linewidth = 2) +
  geom_point(color ="black", size = 2) +
  scale_x_continuous(breaks = c(2003, 2005, 2007,
                                2009, 2011, 2013,
                                2015, 2017)) + 
  scale_y_continuous(breaks = c(200000, 400000, 600000, 800000),
                     labels = c("$200,000", "$400,000", "$600,000", "$800,000")) +
  labs(y = "Price ($)",
       x = "Year",
       caption = "Source: NYC Department of Finance") +
  theme(axis.title.y = element_text(angle = 0, vjust = 0.5))

# GRAPH OF SALES OVER TIME FOR NON-RESIDENTIAL ONLY
brooklyn_sales_nonres |> 
  group_by(year_of_sale) |> 
  mutate(yearly_avg_price = mean(sale_price)) |> 
  ggplot(aes(x = year_of_sale, y = yearly_avg_price)) +
  theme_minimal() +
  geom_line(color = "#e9f2b8", linewidth = 2) +
  geom_point(color = "black", size = 2) +
  scale_x_continuous(breaks = c(2003, 2005, 2007,
                                2009, 2011, 2013,
                                2015, 2017)) + 
  scale_y_continuous(breaks = c(400000, 800000, 1200000, 1600000, 2000000),
                     labels = c("$400,000", "$800,000", "$1,200,000", "$1,600,000", "2,000,000")) +
  labs(y = "Price ($)",
       x = "Year",
       caption = "Source: NYC Department of Finance") +
  theme(axis.title.y = element_text(angle = 0, vjust = 0.5))
```


## What neighborhoods are the most popular in Brooklyn?

## What affects price for housing?

# References {#sec-references}
-   "Annualized Sales Update." NYC Department of Finance, New York City, [www.nyc.gov/site/finance/taxes/property-annualized-sales-update.page](www.nyc.gov/site/finance/taxes/property-annualized-sales-update.page).
-   Wu, Tommy. "Brooklyn Home Sales, 2003 to 2017." Kaggle, 15 Feb. 2018, [www.kaggle.com/datasets/tianhwu/brooklynhomes2003to2017/data](www.kaggle.com/datasets/tianhwu/brooklynhomes2003to2017/data).

